<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced AQI Monitoring System</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Rajdhani', sans-serif;
            background: #0a0e27;
            color: #fff;
            overflow-x: hidden;
            min-height: 100vh;
        }

        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at top, #1a237e 0%, #0a0e27 50%);
            z-index: -1;
        }

        .grid-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 229, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 229, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            z-index: -1;
            animation: gridMove 20s linear infinite;
        }

        @keyframes gridMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
            position: relative;
        }

        .main-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 3.5em;
            font-weight: 900;
            background: linear-gradient(135deg, #00e5ff, #00b8ff, #0091ea);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(0, 229, 255, 0.5);
            letter-spacing: 3px;
            margin-bottom: 10px;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { filter: drop-shadow(0 0 10px #00e5ff); }
            to { filter: drop-shadow(0 0 20px #00e5ff); }
        }

        .subtitle {
            font-size: 1.3em;
            color: #64b5f6;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 229, 255, 0.05);
            border: 1px solid rgba(0, 229, 255, 0.3);
            border-radius: 15px;
            padding: 15px 25px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Orbitron', sans-serif;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 10px currentColor; }
            50% { opacity: 0.5; box-shadow: 0 0 20px currentColor; }
        }

        .connected { background: #00e676; color: #00e676; }
        .disconnected { background: #ff1744; color: #ff1744; }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: linear-gradient(135deg, rgba(26, 35, 126, 0.4), rgba(13, 71, 161, 0.2));
            border: 1px solid rgba(0, 229, 255, 0.3);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 229, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .card:hover::before {
            left: 100%;
        }

        .card:hover {
            transform: translateY(-5px);
            border-color: rgba(0, 229, 255, 0.6);
            box-shadow: 0 12px 40px rgba(0, 229, 255, 0.2);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            gap: 15px;
        }

        .card-icon {
            width: 45px;
            height: 45px;
            padding: 10px;
            background: rgba(0, 229, 255, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(0, 229, 255, 0.3);
        }

        .card-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1em;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #00e5ff;
        }

        /* Main AQI Display */
        .aqi-main {
            grid-column: 1 / 8;
            grid-row: 1 / 3;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .aqi-circle-container {
            position: relative;
            width: 280px;
            height: 280px;
            margin: 20px 0;
        }

        .aqi-circle {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 8px solid rgba(0, 229, 255, 0.3);
            background: radial-gradient(circle, rgba(0, 229, 255, 0.1), transparent);
            box-shadow: 0 0 40px rgba(0, 229, 255, 0.3), inset 0 0 40px rgba(0, 229, 255, 0.1);
            position: relative;
            animation: rotate 10s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .aqi-circle-inner {
            animation: rotate 10s linear infinite reverse;
        }

        .aqi-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 5em;
            font-weight: 900;
            line-height: 1;
            text-shadow: 0 0 20px currentColor;
        }

        .aqi-label {
            font-size: 1.4em;
            margin-top: 10px;
            letter-spacing: 3px;
            opacity: 0.9;
        }

        .status-badge {
            font-family: 'Orbitron', sans-serif;
            padding: 15px 35px;
            border-radius: 30px;
            font-size: 1.5em;
            font-weight: 700;
            margin: 20px 0;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 0 20px currentColor;
            animation: badgePulse 2s infinite;
        }

        @keyframes badgePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Gas Metrics Grid */
        .gas-metric {
            grid-column: span 4;
        }

        .metric-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.8em;
            font-weight: 700;
            margin: 15px 0;
            color: #00e5ff;
            text-shadow: 0 0 10px rgba(0, 229, 255, 0.5);
        }

        .metric-unit {
            font-size: 1.1em;
            color: #64b5f6;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .metric-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 15px;
        }

        .metric-fill {
            height: 100%;
            background: linear-gradient(90deg, #00e5ff, #00b8ff);
            border-radius: 10px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px #00e5ff;
        }

        /* Charts */
        .chart-card {
            grid-column: span 6;
            min-height: 350px;
        }

        .chart-container {
            height: 280px;
            margin-top: 20px;
        }

        /* Environmental Factors */
        .env-card {
            grid-column: span 3;
        }

        .env-reading {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(0, 229, 255, 0.05);
            border-radius: 12px;
            margin-top: 15px;
            border: 1px solid rgba(0, 229, 255, 0.2);
        }

        .env-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8em;
            font-weight: 700;
            color: #00e5ff;
        }

        /* Statistics */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .stat-item {
            background: rgba(0, 229, 255, 0.05);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(0, 229, 255, 0.2);
        }

        .stat-label {
            font-size: 0.9em;
            color: #64b5f6;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .stat-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.6em;
            font-weight: 700;
            color: #00e5ff;
        }

        /* Health Alert */
        .health-alert {
            grid-column: span 12;
        }

        .alert-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .alert-item {
            padding: 20px;
            background: rgba(0, 229, 255, 0.05);
            border-left: 4px solid #00e5ff;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .alert-item:hover {
            background: rgba(0, 229, 255, 0.1);
            transform: translateX(5px);
        }

        .alert-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .alert-text {
            font-size: 1.1em;
            line-height: 1.6;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .aqi-main { grid-column: 1 / 13; grid-row: auto; }
            .chart-card { grid-column: span 12; }
            .gas-metric { grid-column: span 6; }
            .env-card { grid-column: span 6; }
        }

        @media (max-width: 768px) {
            .main-title { font-size: 2em; }
            .subtitle { font-size: 1em; }
            .status-bar { flex-direction: column; gap: 15px; }
            .gas-metric, .env-card { grid-column: span 12; }
            .aqi-circle-container { width: 200px; height: 200px; }
            .aqi-value { font-size: 3.5em; }
            .stats-grid { grid-template-columns: 1fr; }
        }

        .timestamp {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9em;
            color: #64b5f6;
            margin-top: 15px;
        }

        .loading {
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>
    <div class="grid-overlay"></div>

    <div class="container">
        <header>
            <h1 class="main-title">AIR QUALITY MONITORING SYSTEM</h1>
            <p class="subtitle">Real-Time Environmental Analysis ‚Ä¢ ESP32 + MQ135</p>
        </header>

        <div class="status-bar">
            <div class="status-item">
                <div class="status-dot disconnected" id="statusDot"></div>
                <span id="statusText">INITIALIZING SYSTEM...</span>
            </div>
            <div class="status-item">
                <span>‚ö° SENSOR: <span id="sensorStatus">STANDBY</span></span>
            </div>
            <div class="status-item">
                <span>üì° NETWORK: <span id="networkStatus">CONNECTING</span></span>
            </div>
            <div class="status-item">
                <span id="systemTime">--:--:--</span>
            </div>
        </div>

        <div class="dashboard-grid">
            <!-- Main AQI Display -->
            <div class="card aqi-main">
                <h2 class="card-title" style="font-size: 1.5em; margin-bottom: 20px;">AIR QUALITY INDEX</h2>
                <div class="aqi-circle-container">
                    <div class="aqi-circle" id="aqiCircle">
                        <div class="aqi-circle-inner">
                            <div class="aqi-value" id="aqiValue">--</div>
                            <div class="aqi-label">AQI</div>
                        </div>
                    </div>
                </div>
                <div class="status-badge" id="statusBadge">WAITING FOR DATA</div>
                <div class="timestamp" id="lastUpdate">Last Update: --</div>
            </div>

            <!-- Gas Concentration -->
            <div class="card gas-metric">
                <div class="card-header">
                    <svg class="card-icon" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
                        <circle cx="12" cy="12" r="3"/>
                    </svg>
                    <h3 class="card-title">Gas PPM</h3>
                </div>
                <div class="metric-value" id="ppmValue">--</div>
                <div class="metric-unit">Parts Per Million</div>
                <div class="metric-bar">
                    <div class="metric-fill" id="ppmBar" style="width: 0%"></div>
                </div>
            </div>

            <!-- CO2 Equivalent -->
            <div class="card gas-metric">
                <div class="card-header">
                    <svg class="card-icon" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                    </svg>
                    <h3 class="card-title">CO‚ÇÇ Equivalent</h3>
                </div>
                <div class="metric-value" id="co2Value">--</div>
                <div class="metric-unit">ppm</div>
                <div class="metric-bar">
                    <div class="metric-fill" id="co2Bar" style="width: 0%"></div>
                </div>
            </div>

            <!-- Resistance -->
            <div class="card gas-metric">
                <div class="card-header">
                    <svg class="card-icon" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                    </svg>
                    <h3 class="card-title">Sensor Resistance</h3>
                </div>
                <div class="metric-value" id="resistanceValue">--</div>
                <div class="metric-unit">kŒ©</div>
                <div class="metric-bar">
                    <div class="metric-fill" id="resistanceBar" style="width: 0%"></div>
                </div>
            </div>

            <!-- AQI History Chart -->
            <div class="card chart-card">
                <div class="card-header">
                    <svg class="card-icon" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"/>
                    </svg>
                    <h3 class="card-title">AQI Trend Analysis</h3>
                </div>
                <div class="chart-container">
                    <canvas id="aqiChart"></canvas>
                </div>
            </div>

            <!-- Gas Concentration Chart -->
            <div class="card chart-card">
                <div class="card-header">
                    <svg class="card-icon" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                    </svg>
                    <h3 class="card-title">Gas Concentration History</h3>
                </div>
                <div class="chart-container">
                    <canvas id="gasChart"></canvas>
                </div>
            </div>

            <!-- Statistics -->
            <div class="card env-card">
                <div class="card-header">
                    <svg class="card-icon" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M19 3H5c-1.1 0-1.99.9-1.99 2L3 19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                    </svg>
                    <h3 class="card-title">Statistics</h3>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">Average AQI</div>
                        <div class="stat-value" id="avgAqi">--</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Peak AQI</div>
                        <div class="stat-value" id="maxAqi">--</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Min AQI</div>
                        <div class="stat-value" id="minAqi">--</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Data Points</div>
                        <div class="stat-value" id="dataPoints">0</div>
                    </div>
                </div>
            </div>

            <!-- Environmental Readings -->
            <div class="card env-card">
                <div class="card-header">
                    <svg class="card-icon" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2zm9 7h-6v13h-2v-6h-2v6H9V9H3V7h18v2z"/>
                    </svg>
                    <h3 class="card-title">Sensor Data</h3>
                </div>
                <div class="env-reading">
                    <span>Raw ADC Value</span>
                    <span class="env-value" id="rawValue">--</span>
                </div>
                <div class="env-reading">
                    <span>Voltage (V)</span>
                    <span class="env-value" id="voltageValue">--</span>
                </div>
                <div class="env-reading">
                    <span>Rs/Ro Ratio</span>
                    <span class="env-value" id="ratioValue">--</span>
                </div>
            </div>

            <!-- Air Quality Breakdown -->
            <div class="card env-card">
                <div class="card-header">
                    <svg class="card-icon" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    <h3 class="card-title">Air Quality Breakdown</h3>
                </div>
                <div class="env-reading">
                    <span>NH‚ÇÉ (Ammonia)</span>
                    <span class="env-value" id="nh3Value">--</span>
                </div>
                <div class="env-reading">
                    <span>NOx (Nitrogen Oxides)</span>
                    <span class="env-value" id="noxValue">--</span>
                </div>
                <div class="env-reading">
                    <span>Benzene</span>
                    <span class="env-value" id="benzeneValue">--</span>
                </div>
            </div>

            <!-- Health Recommendations -->
            <div class="card health-alert">
                <div class="card-header">
                    <svg class="card-icon" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
                    </svg>
                    <h3 class="card-title">Health Recommendations & Safety Guidelines</h3>
                </div>
                <div class="alert-content" id="healthAlerts">
                    <div class="alert-item">
                        <div class="alert-icon">‚è≥</div>
                        <div class="alert-text">Waiting for air quality data to generate health recommendations...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        // ==================== CONFIGURATION ====================
        const ESP32_IP = '10.201.226.170'; // CHANGE THIS TO YOUR ESP32 IP
        const UPDATE_INTERVAL = 2000; // Update every 2 seconds
        const MAX_DATA_POINTS = 30;

        // ==================== DATA STORAGE ====================
        let historyData = {
            aqi: [],
            ppm: [],
            co2: [],
            timestamps: []
        };

        let statistics = {
            sum: 0,
            count: 0,
            max: 0,
            min: Infinity
        };

        // ==================== CHART SETUP ====================
        const aqiChartCtx = document.getElementById('aqiChart').getContext('2d');
        const aqiChart = new Chart(aqiChartCtx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'AQI',
                    data: [],
                    borderColor: '#00e5ff',
                    backgroundColor: 'rgba(0, 229, 255, 0.1)',
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true,
                    pointRadius: 4,
                    pointBackgroundColor: '#00e5ff',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 500,
                        ticks: { color: '#64b5f6', font: { family: 'Orbitron' } },
                        grid: { color: 'rgba(100, 181, 246, 0.1)' }
                    },
                    x: {
                        ticks: { color: '#64b5f6', font: { family: 'Orbitron' } },
                        grid: { color: 'rgba(100, 181, 246, 0.1)' }
                    }
                }
            }
        });

        const gasChartCtx = document.getElementById('gasChart').getContext('2d');
        const gasChart = new Chart(gasChartCtx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'PPM',
                    data: [],
                    borderColor: '#00e676',
                    backgroundColor: 'rgba(0, 230, 118, 0.1)',
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true,
                    yAxisID: 'y'
                }, {
                    label: 'CO‚ÇÇ (ppm)',
                    data: [],
                    borderColor: '#ff9800',
                    backgroundColor: 'rgba(255, 152, 0, 0.1)',
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true,
                    yAxisID: 'y1'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: { color: '#64b5f6', font: { family: 'Orbitron' } }
                    }
                },
                scales: {
                    y: {
                        type: 'linear',
                        position: 'left',
                        ticks: { color: '#00e676', font: { family: 'Orbitron' } },
                        grid: { color: 'rgba(0, 230, 118, 0.1)' }
                    },
                    y1: {
                        type: 'linear',
                        position: 'right',
                        ticks: { color: '#ff9800', font: { family: 'Orbitron' } },
                        grid: { display: false }
                    },
                    x: {
                        ticks: { color: '#64b5f6', font: { family: 'Orbitron' } },
                        grid: { color: 'rgba(100, 181, 246, 0.1)' }
                    }
                }
            }
        });

        // ==================== CALCULATION FUNCTIONS ====================
        function calculateAQI(ppm) {
            let aqi, status, color;
            
            if (ppm <= 50) {
                aqi = Math.round(ppm);
                status = 'GOOD';
                color = '#00e676';
            } else if (ppm <= 100) {
                aqi = Math.round(50 + (ppm - 50));
                status = 'MODERATE';
                color = '#ffd54f';
            } else if (ppm <= 150) {
                aqi = Math.round(100 + (ppm - 100) * 0.5);
                status = 'UNHEALTHY FOR SENSITIVE';
                color = '#ff9800';
            } else if (ppm <= 200) {
                aqi = Math.round(125 + (ppm - 150) * 0.5);
                status = 'UNHEALTHY';
                color = '#f44336';
            } else if (ppm <= 300) {
                aqi = Math.round(150 + (ppm - 200) * 0.5);
                status = 'VERY UNHEALTHY';
                color = '#9c27b0';
            } else {
                aqi = Math.round(200 + (ppm - 300) * 0.33);
                status = 'HAZARDOUS';
                color = '#880e4f';
            }
            
            return { aqi: Math.min(aqi, 500), status, color };
        }

        function calculateCO2(ppm) {
            return Math.round(ppm * 10 + 400); // Simplified conversion
        }

        function calculateResistance(rawValue) {
            const RL = 10; // Load resistance in kŒ©
            const VCC = 3.3; // ESP32 voltage
            const voltage = (rawValue / 4095.0) * VCC;
            const RS = ((VCC - voltage) / voltage) * RL;
            return RS.toFixed(2);
        }

        function getHealthRecommendations(status, aqi) {
            const recommendations = {
                'GOOD': [
                    { icon: '‚úÖ', text: 'Air quality is excellent! Perfect conditions for outdoor activities and exercise.' },
                    { icon: 'üèÉ', text: 'No health precautions necessary. Enjoy outdoor sports and activities freely.' },
                    { icon: 'üå≥', text: 'Open windows to let fresh air circulate throughout your home.' }
                ],
                'MODERATE': [
                    { icon: '‚ö†Ô∏è', text: 'Air quality is acceptable for most people. Unusually sensitive individuals should consider limiting prolonged outdoor exertion.' },
                    { icon: 'üë•', text: 'People with respiratory conditions should monitor symptoms closely.' },
                    { icon: 'ü™ü', text: 'Ventilation is generally safe, but sensitive individuals may prefer filtered air.' }
                ],
                'UNHEALTHY FOR SENSITIVE': [
                    { icon: 'üî∂', text: 'Sensitive groups (children, elderly, those with heart/lung disease) should reduce prolonged or heavy outdoor exertion.' },
                    { icon: 'üò∑', text: 'Consider wearing masks outdoors if you are in a sensitive group.' },
                    { icon: 'üè†', text: 'Keep windows closed and use air purifiers if available.' }
                ],
                'UNHEALTHY': [
                    { icon: 'üî¥', text: 'Everyone should reduce prolonged or heavy outdoor exertion. Take more breaks during outdoor activities.' },
                    { icon: 'üö´', text: 'Sensitive groups should avoid outdoor activities entirely.' },
                    { icon: 'üí®', text: 'Use HEPA air purifiers indoors and keep windows/doors closed.' }
                ],
                'VERY UNHEALTHY': [
                    { icon: 'üö®', text: 'HEALTH WARNING: Everyone should avoid all outdoor physical activities.' },
                    { icon: 'üè†', text: 'Stay indoors with windows and doors closed. Use air purification systems.' },
                    { icon: 'üò∑', text: 'Wear N95 masks if you must go outside. Sensitive groups should remain indoors.' }
                ],
                'HAZARDOUS': [
                    { icon: '‚ò†Ô∏è', text: 'EMERGENCY CONDITIONS: Everyone should avoid all outdoor activities.' },
                    { icon: 'üîí', text: 'Remain indoors with all windows and doors sealed. Use maximum air filtration.' },
                    { icon: 'üöë', text: 'Seek immediate medical attention if experiencing difficulty breathing or chest pain.' }
                ]
            };
            
            return recommendations[status] || recommendations['GOOD'];
        }

        // ==================== UI UPDATE FUNCTIONS ====================
        function updateDashboard(data) {
            const { aqi, status, color } = calculateAQI(data.ppm);
            const co2 = calculateCO2(data.ppm);
            const resistance = calculateResistance(data.raw);
            const voltage = ((data.raw / 4095.0) * 3.3).toFixed(2);
            const ratio = (resistance / 10).toFixed(2); // Assuming R0 = 10kŒ©
            
            // Update main AQI display
            document.getElementById('aqiValue').textContent = aqi;
            document.getElementById('aqiValue').style.color = color;
            document.getElementById('aqiCircle').style.borderColor = color;
            document.getElementById('aqiCircle').style.boxShadow = `0 0 40px ${color}, inset 0 0 40px ${color}33`;
            document.getElementById('statusBadge').textContent = status;
            document.getElementById('statusBadge').style.background = color;
            document.getElementById('statusBadge').style.color = '#fff';
            
            // Update metrics
            document.getElementById('ppmValue').textContent = data.ppm.toFixed(1);
            document.getElementById('ppmBar').style.width = `${Math.min((data.ppm / 300) * 100, 100)}%`;
            
            document.getElementById('co2Value').textContent = co2;
            document.getElementById('co2Bar').style.width = `${Math.min((co2 / 2000) * 100, 100)}%`;
            
            document.getElementById('resistanceValue').textContent = resistance;
            document.getElementById('resistanceBar').style.width = `${Math.min((resistance / 50) * 100, 100)}%`;
            
            // Update sensor data
            document.getElementById('rawValue').textContent = data.raw;
            document.getElementById('voltageValue').textContent = voltage;
            document.getElementById('ratioValue').textContent = ratio;
            
            // Update gas breakdown (simulated values based on MQ135 characteristics)
            document.getElementById('nh3Value').textContent = Math.round(data.ppm * 0.4) + ' ppm';
            document.getElementById('noxValue').textContent = Math.round(data.ppm * 0.3) + ' ppm';
            document.getElementById('benzeneValue').textContent = Math.round(data.ppm * 0.2) + ' ppm';
            
            // Update timestamps
            const now = new Date();
            document.getElementById('lastUpdate').textContent = `Last Update: ${now.toLocaleTimeString()}`;
            document.getElementById('systemTime').textContent = now.toLocaleTimeString();
            
            // Update statistics
            statistics.sum += aqi;
            statistics.count++;
            statistics.max = Math.max(statistics.max, aqi);
            statistics.min = Math.min(statistics.min, aqi);
            
            document.getElementById('avgAqi').textContent = Math.round(statistics.sum / statistics.count);
            document.getElementById('maxAqi').textContent = statistics.max;
            document.getElementById('minAqi').textContent = statistics.min;
            document.getElementById('dataPoints').textContent = statistics.count;
            
            // Update history
            historyData.aqi.push(aqi);
            historyData.ppm.push(data.ppm);
            historyData.co2.push(co2);
            historyData.timestamps.push(now.toLocaleTimeString());
            
            if (historyData.aqi.length > MAX_DATA_POINTS) {
                historyData.aqi.shift();
                historyData.ppm.shift();
                historyData.co2.shift();
                historyData.timestamps.shift();
            }
            
            // Update charts
            aqiChart.data.labels = historyData.timestamps;
            aqiChart.data.datasets[0].data = historyData.aqi;
            aqiChart.data.datasets[0].borderColor = color;
            aqiChart.data.datasets[0].backgroundColor = color + '33';
            aqiChart.update();
            
            gasChart.data.labels = historyData.timestamps;
            gasChart.data.datasets[0].data = historyData.ppm;
            gasChart.data.datasets[1].data = historyData.co2;
            gasChart.update();
            
            // Update health alerts
            const recommendations = getHealthRecommendations(status, aqi);
            const alertsHTML = recommendations.map(rec => `
                <div class="alert-item">
                    <div class="alert-icon">${rec.icon}</div>
                    <div class="alert-text">${rec.text}</div>
                </div>
            `).join('');
            document.getElementById('healthAlerts').innerHTML = alertsHTML;
            
            // Update connection status
            document.getElementById('statusDot').className = 'status-dot connected';
            document.getElementById('statusText').textContent = 'SYSTEM ONLINE';
            document.getElementById('sensorStatus').textContent = 'ACTIVE';
            document.getElementById('networkStatus').textContent = 'CONNECTED';
        }

        // ==================== DATA FETCHING ====================
        async function fetchData() {
            try {
                const response = await fetch(`http://10.201.226.170/data`);
                const data = await response.json();
                updateDashboard(data);
            } catch (error) {
                console.error('Connection error:', error);
                document.getElementById('statusDot').className = 'status-dot disconnected';
                document.getElementById('statusText').textContent = 'CONNECTION LOST';
                document.getElementById('sensorStatus').textContent = 'OFFLINE';
                document.getElementById('networkStatus').textContent = 'DISCONNECTED';
            }
        }

        // ==================== DEMO MODE (Remove when using real ESP32) ====================
        function simulateData() {
            const data = {
                ppm: Math.random() * 150 + 30,
                raw: Math.floor(Math.random() * 2048 + 1024)
            };
            updateDashboard(data);
        }

        // ==================== INITIALIZATION ====================
        setInterval(() => {
            fetchData(); // UNCOMMENT THIS FOR REAL ESP32
            // simulateData(); // REMOVE THIS LINE FOR REAL ESP32
        }, UPDATE_INTERVAL);

        // Initial call
        fetchData(); // REPLACE WITH fetchData() FOR REAL ESP32
    </script>
</body>
</html>